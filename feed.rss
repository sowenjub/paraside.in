<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content"><channel><title>üèù Living in Paraside</title><description>Paraside [p…õ.…π…ô.sa…™d] - A mind archipelago where dreams come true</description><link>https://paraside.in</link><language>en</language><lastBuildDate>Mon, 10 Aug 2020 22:43:37 +0200</lastBuildDate><pubDate>Mon, 10 Aug 2020 22:43:37 +0200</pubDate><ttl>250</ttl><atom:link href="https://paraside.in/feed.rss" rel="self" type="application/rss+xml"/><item><guid isPermaLink="true">https://paraside.in/design+code/emoji-picker-controller-with-stimulus-js</guid><title>Emoji picker controller with StimulusJS and Emoji Button</title><description>Adding an emoji picker to a Rails app</description><link>https://paraside.in/design+code/emoji-picker-controller-with-stimulus-js</link><pubDate>Wed, 15 Jul 2020 22:01:00 +0200</pubDate><content:encoded><![CDATA[<p>I needed an emoji picker for my latest Rails app and found <a href="https://github.com/joeattardi/emoji-button">Emoji Button</a> by @joeattardi that he introduced <a href="https://dev.to/joeattardi/emoji-button-a-vanilla-javascript-emoji-picker-1lf9">here</a>.</p><img src="https://dev-to-uploads.s3.amazonaws.com/i/0rn1pcp9tlk73nzrnuki.png" alt="Alt Text"/><p>Since he already did the heavy-lifting required to provide a vanilla JavaScript emoji picker component, I just needed to add it to my app and create a Stimulus controller. And here's how to do it for yours.</p><p>I'll assume you already have <a href="https://stimulusjs.org">StimulusJS</a> installed. From there, it's only a couple of steps.</p><p>First, open your Terminal and add the emoji-button package.</p><pre><code><div class="highlight"><span></span>yarn add @joeattardi/emoji-button
</div></code></pre><p>Then, create a <code>app/javascript/controllers/emoji_picker_controller.js</code> with this code inside</p><pre><code><div class="highlight"><span></span><span class="n">import</span> <span class="p">{</span> <span class="no">Controller</span> <span class="p">}</span> <span class="n">from</span> <span class="s2">&quot;stimulus&quot;</span>
<span class="n">import</span> <span class="no">EmojiButton</span> <span class="n">from</span> <span class="s1">&#39;@joeattardi/emoji-button&#39;</span>

<span class="n">export</span> <span class="n">default</span> <span class="k">class</span> <span class="n">extends</span> <span class="no">Controller</span> <span class="p">{</span>
  <span class="n">static</span> <span class="n">targets</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;button&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span> <span class="o">]</span>

  <span class="n">connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">picker</span> <span class="o">=</span> <span class="kp">new</span> <span class="no">EmojiButton</span><span class="p">()</span>
    <span class="n">this</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;emoji&#39;</span><span class="p">,</span> <span class="n">emoji</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="n">this</span><span class="o">.</span><span class="n">buttonTarget</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="n">emoji</span>
      <span class="n">this</span><span class="o">.</span><span class="n">inputTarget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">emoji</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="n">toggle</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">event</span><span class="o">.</span><span class="n">preventDefault</span><span class="p">()</span>
    <span class="n">this</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">togglePicker</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>And now, if you have a <code>Post</code> model with an <code>emoji</code> attribute, you can do this in your form (the syntax below uses Slim instead of ERB):</p><pre><code><div class="highlight"><span></span><span class="o">=</span> <span class="n">form_for</span> <span class="n">post</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="n">post_path</span><span class="p">(</span><span class="n">post</span><span class="p">),</span> <span class="ss">data</span><span class="p">:</span> <span class="p">{</span> <span class="ss">controller</span><span class="p">:</span> <span class="s2">&quot;emoji-picker&quot;</span> <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
  <span class="n">button</span> <span class="n">data</span><span class="o">-</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;emoji-picker#toggle&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;emoji-picker.button&quot;</span>
    <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">emoji</span><span class="o">.</span><span class="n">presence</span> <span class="o">||</span> <span class="n">content_tag</span><span class="p">(</span><span class="ss">:i</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;fad fa-smile text-gray-400&quot;</span><span class="p">)</span>
    <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">hidden_field</span> <span class="ss">:emoji</span><span class="p">,</span> <span class="ss">data</span><span class="p">:</span> <span class="p">{</span> <span class="ss">target</span><span class="p">:</span> <span class="s2">&quot;emoji-picker.input&quot;</span> <span class="p">}</span>
</div></code></pre><p>The <code>content_tag(:i, nil, class: "fad fa-smile text-gray-400")</code> bit uses <a href="https://fontawesome.com">FontAwesome</a> to show a default gray emoji when there is none.</p><p>And that's all there is to it. Anytime you click the button, the picker will be toggled, and if you select an emoji, both the button and the hidden form input will be updated.</p>]]></content:encoded></item><item><guid isPermaLink="true">https://paraside.in/design+code/required-form-label-with-rails-tailwindcss</guid><title>Rails+TailwindCSS: adding "required" to form labels (and how to find the solution by yourself)</title><description>This post addresses a simple need: adding a "required" text next to any form field label that is‚Ä¶ required.</description><link>https://paraside.in/design+code/required-form-label-with-rails-tailwindcss</link><pubDate>Fri, 10 Jul 2020 22:01:00 +0200</pubDate><content:encoded><![CDATA[<p>This post addresses a simple need: adding a "required" text next to any form field label that is‚Ä¶ required.</p><p>But I wanted a solution: <em> using only TailwindCSS/TailwindUI existing classes </em> that can be reused easily <em> internationalization friendly (because we're using a word - required - and not the "</em>" sign as you often see) <em> that doesn't reinvent the wheel in some way </em> that looks like this</p><img src="https://dev-to-uploads.s3.amazonaws.com/i/4isnogc6vypl829kl0k1.png" alt="Alt Text"/><h1>For the coder in a hurry, my solution</h1><p>The gist of it is <code>label_builder.translation</code>.</p><pre><code><div class="highlight"><span></span><span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;block text-xxs uppercase text-gray-500&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">label_builder</span><span class="o">|</span>
  <span class="p">=</span> <span class="n">label_builder</span><span class="o">.</span><span class="n">translation</span>
  <span class="nt">span</span><span class="nc">.ml-2.normal-case.text-orange-400.text-xxs.font-semibold</span><span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">)</span>
  <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">autocomplete</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;form-input mt-1 block w-full text-field focus:shadow-outline focus:border-green-300&quot;</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">&quot;richard@piedpiper.com&quot;</span>
</div></code></pre><p>Note: I use the <a href="https://github.com/slim-template/slim">Slim</a> template language instead of ERB; it's easier to read so I trust that even if you've never heard of it you won't be lost.</p><h1>For the curious mind, how I got there and why</h1><p><em>FAIR WARNING: the rest is not your typical technical article. You already have the solution above, the rest is about how I found the solution. So it's more a story than a guide.</em></p><p>Here I was setting up a simple profile form, adding the proper <code>required: true</code> attributes and looking at it when I realized: <strong>how the hell would a user know which fields are required and which aren't?</strong></p><p>Like anyone, anytime I see a form, my mind looks for the easy way out and tries to figure out how to hit that submit button as quickly as possible. This bland form triggered my fill or flight response and I knew I had to do something about it.</p><h2>Starting point</h2><p>With a bit of TailwindCSS, here is what it was looking like.</p><img src="https://dev-to-uploads.s3.amazonaws.com/i/1eyy0fn26yk5ozi1knph.png" alt="Alt Text"/><p>and the code</p><pre><code><div class="highlight"><span></span><span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;block text-xxs uppercase text-gray-500&quot;</span>
<span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">autocomplete</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;form-input mt-1 block w-full text-field focus:shadow-outline focus:border-green-300&quot;</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">&quot;richard@piedpiper.com&quot;</span>
</div></code></pre><p>It's as basic as it gets: a label and an email_field with some classes. I will skip the TailwindCSS explanations, just know that "form-input" comes from a <a href="https://tailwindcss-custom-forms.netlify.app">plugin</a>.</p><p>Goal check:</p><ul><li>‚úÖ using only TailwindCSS/TailwindUI existing classes</li><li>‚ùå that can be reused easily</li><li>‚ùå internationalization friendly</li><li>‚ùå that doesn't reinvent the wheel in some way</li><li>‚ùå that looks like the cover image</li></ul><h2>Approach n¬∞1: Add a "*" after the email</h2><p>Often, forms signal that a field is required by appending an asterisk to the label title, which can be done with a bit of CSS.</p><pre><code><div class="highlight"><span></span>  <span class="p">.</span><span class="nc">required</span><span class="p">:</span><span class="nd">after</span> <span class="p">{</span>
    <span class="k">content</span><span class="p">:</span><span class="s2">&quot; *&quot;</span><span class="p">;</span>
  <span class="p">}</span>
</div></code></pre><p>I went to the <a href="https://tailwindcss.com/docs/installation">TailwindCSS docs</a> and couldn't find anything ready-made to handle this. Sure, I could add it to my stylesheet files, but I already had another idea in mind. I played a little bit with <a href="https://basecamp.com">Basecamp</a> recently as I watched the <a href="https://www.youtube.com/playlist?list=PL9wALaIpe0Py6E_oHCgTrD6FvFETwJLlx">On Writing Software (well?)</a> videos by <a href="http://twitter.com/dhh">DHH</a>. And it reminded me that using the word "required" instead of a simple "*" sign is great to improve clarity.</p><h2>Approach n¬∞2: Appeal to humanity</h2><p>This confusing title is a bad pun inspired the method we'll be using in this approach: <code>Model.human_attribute_name</code>.</p><p>Since <code>label</code> can take a block to render, it's easy to come up with a first solution.</p><p>So I went from</p><pre><code><div class="highlight"><span></span><span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;block text-xxs uppercase text-gray-500&quot;</span>
</div></code></pre><p>to</p><pre><code><div class="highlight"><span></span><span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;block text-xxs uppercase text-gray-500&quot;</span> <span class="k">do</span>
  | Email
  <span class="nt">span</span><span class="nc">.ml-2.normal-case.text-orange-400.text-xxs.font-semibold</span> required
</div></code></pre><p>OK. It looks like the final result, but <strong>we're not quite there yet, because both "Email" and "required" are hardcoded</strong>.</p><p>Goal check:</p><ul><li>‚úÖ using only TailwindCSS/TailwindUI existing classes</li><li>‚ùå that can be reused easily</li><li>‚ùå internationalization friendly</li><li>‚ùå that doesn't reinvent the wheel in some way</li><li>‚úÖ that looks like the cover image</li></ul><p>The "required" text doesn't need much talking about. We just have to replace it with <code>= t("required")</code> and add a translation somewhere, probably in <code>config/locals/en.yml</code> since it will be pretty generic.</p><pre><code><div class="highlight"><span></span><span class="n">en</span><span class="p">:</span>
  <span class="kr">required</span><span class="p">:</span> <span class="kr">required</span>
</div></code></pre><p>But what about the email? I needed a solution that would be a bit more generic. The <a href="https://guides.rubyonrails.org/i18n.html#translations-for-active-record-models">standard way to look up translations</a> for any attribute is <code>Model.human_attribute_name(:attribute)</code>, so I did just that.</p><pre><code><div class="highlight"><span></span><span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;block text-xxs uppercase text-gray-500&quot;</span> <span class="k">do</span>
  <span class="cp">/ üëç Not horrible</span>
  <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span>
  <span class="nt">span</span><span class="nc">.ml-2.normal-case.text-orange-400.text-xxs.font-semibold</span><span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">)</span>
  <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">autocomplete</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;form-input mt-1 block w-full text-field focus:shadow-outline focus:border-green-300&quot;</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">&quot;richard@piedpiper.com&quot;</span>
</div></code></pre><p>At this point, I am relying on common techniques. A little bit unsatisfying but it gets the job done.</p><p>What did I find unsatisfying, you may wonder?</p><p>Generally speaking, rails take care of many intricacies you might not think of. When you're replicating part of a method (in our case the part that takes a symbol - :email - and turns it into text - Email -), it's highly likely you're forgetting edge cases or oversimplifying. It's like using a steering wheel versus ropes tied to the wheels. Sure, it works, you have a direct grip on things, but there's a reason we built an intermediary thingy.</p><p>In particular, by doing our own thing instead of relying on rails' wisdom, we're missing out on lazy lookup cleverness. And in our case, by using <code>Model.human_attribute_name</code> directly, we are reinventing the wheel.</p><p>Goal check:</p><ul><li>‚úÖ using only TailwindCSS/TailwindUI existing classes</li><li>‚úÖ that can be reused easily</li><li>‚úÖ internationalization friendly</li><li>‚ùå that doesn't reinvent the wheel in some way</li><li>‚úÖ that looks like the cover image</li></ul><h2>Final approach</h2><p>Where to go from there? I knew that the <code>label</code> helper was handling the translation at some level, and I wanted to know if you could tap into it.</p><p>There was two way to deal with this. The easy way, and the way I did it because‚Ä¶ I got carried away.</p><h3>Let's start with the laborious (but still interesting) way</h3><p>The easiest way to know how the <code>label</code> helper handles the translation is to look at the source code Using <a href="https://kapeli.com/dash">Dash</a>, I opened the rails source code and found <a href="https://github.com/rails/rails/blob/b738f1930f3c82f51741ef7241c1fee691d7deb2/actionview/lib/action_view/helpers/form_helper.rb#L2252">this</a></p><pre><code><div class="highlight"><span></span><span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="vi">@template</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="vi">@object_name</span><span class="p">,</span> <span class="nb">method</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">objectify_options</span><span class="p">(</span><span class="n">options</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
<span class="k">end</span>
</div></code></pre><p>I clicked the label call and looked at the definitions found by Github's code navigation (I only discovered recently that Github lets you do that, so I'm mentioning it here in case you didn't know about).</p><img src="https://dev-to-uploads.s3.amazonaws.com/i/g5dzkaz8ga9tsg0misky.png" alt="Alt Text"/><p>The method's signature of the <a href="https://github.com/rails/rails/blob/a0e0f0263902896a7aacf703bcab35bee16bdaf8/actionview/lib/action_view/helpers/form_helper.rb#L1118">first row</a> seems to match the one used before, so I followed it and found this, which doesn't do much:</p><pre><code><div class="highlight"><span></span><span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="n">object_name</span><span class="p">,</span> <span class="nb">method</span><span class="p">,</span> <span class="n">content_or_options</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="no">Tags</span><span class="o">::</span><span class="no">Label</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">object_name</span><span class="p">,</span> <span class="nb">method</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="n">content_or_options</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
<span class="k">end</span>
</div></code></pre><p>From there, I followed <code>Tags::Label</code> and finally arrived on the <a href="https://github.com/rails/rails/blob/a0e0f0263902896a7aacf703bcab35bee16bdaf8/actionview/lib/action_view/helpers/tags/label.rb#L6">LabelBuilder</a> Here I started to skim through the code, but I didn't have to go far because, at the very top, I saw a promising <code>def translation</code>.</p><p>I went back to the code, added a parameter to the block call that I felt should be named label_builder, and called its translation method.</p><pre><code><div class="highlight"><span></span><span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;block text-xxs uppercase text-gray-500&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">label_builder</span><span class="o">|</span>
  <span class="cp">/ ‚ú® True magic</span>
  <span class="p">=</span> <span class="n">label_builder</span><span class="o">.</span><span class="n">translation</span>
  <span class="nt">span</span><span class="nc">.ml-2.normal-case.text-orange-400.text-xxs.font-semibold</span><span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">)</span>
  <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">autocomplete</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;form-input mt-1 block w-full text-field focus:shadow-outline focus:border-green-300&quot;</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">&quot;richard@piedpiper.com&quot;</span>
</div></code></pre><p>This translation is closer to the template engine than the previous solution.</p><h3>The easy way</h3><p>Before we go further, here is the easy way to find that same method in less time.</p><p>You just have to a) use the console</p><pre><code><div class="highlight"><span></span><span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;block text-xxs uppercase text-gray-500&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">label_builder</span><span class="o">|</span>
  <span class="p">-</span> <span class="n">console</span>
</div></code></pre><p>b) load the page in your browser, wait for the console to appear, and type <code>label_builder.methods</code> to return the list of the names of methods of our label_builder: <code>:translation</code> is the very first one.</p><img src="https://dev-to-uploads.s3.amazonaws.com/i/u22smpon0xpra2yqk1ml.png" alt="Alt Text"/><p>Why didn't I think of that? Force of habits mostly. I've found a lot of solutions recently by reading code so it was my first instinct. Also, I didn't think it would be that easy, ie that the <code>LabelBuilder</code> would just expose the translation. But I must admit that the prospect of reading code and learning a thing or two because of it was also appealing. I find that it's always worth my time.</p><h3>Why is it better and what did we learn?</h3><p>Remember when I told you that we were missing out on lazy lookup cleverness? You can reveal it using <a href="https://github.com/fphilipe/i18n-debug">i18n-debug</a>.</p><p>The previous solution using <code>human_attribute_name</code> looks for this key:</p><pre><code><div class="highlight"><span></span>en.activerecord.attributes.contact.email
</div></code></pre><p>Our new solution first looks for one specific to labels and only falls back on the model one if it's nil.</p><pre><code><div class="highlight"><span></span>en.helpers.label.contact.email
en.activerecord.attributes.contact.email
</div></code></pre><p>This is way more satisfying üòå and the end of the original article.</p><p>I wanted to not only share my solution but also the tools I use as well as a way to go beyond duck-taping (which to me is any approach up to - and including - the <code>human_attribute_name</code> approach).</p><p>At this point you know how to add a "required" text to form labels:</p><ul><li>‚úÖ using only TailwindCSS/TailwindUI existing classes</li><li>‚úÖ that can be reused easily</li><li>‚úÖ internationalization friendly</li><li>‚úÖ that doesn't reinvent the wheel in some way</li><li>‚úÖ that looks like the cover image</li></ul><h1>For the Stakhanovites, going further with a Form Builder</h1><p>I didn't plan to go that far initially, but I couldn't resist once I thought about it üò¨</p><p>If you're going to do that often, you'll probably want to start <a href="https://guides.rubyonrails.org/form_helpers.html#customizing-form-builders">customizing form builders</a> in order to make all of this even more reusable, write less code and get even closer to vanilla rails.</p><p>Indeed, with a form builder we can simply write something like this:</p><pre><code><div class="highlight"><span></span><span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;block text-xxs uppercase text-gray-500&quot;</span><span class="p">,</span> <span class="ss">required_class</span><span class="p">:</span> <span class="s2">&quot;ml-2 normal-case text-orange-400 text-xxs font-semibold&quot;</span>
<span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">autocomplete</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;form-input mt-1 block w-full text-field focus:shadow-outline focus:border-green-300&quot;</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">&quot;richard@piedpiper.com&quot;</span>
</div></code></pre><p>If you compare it to our starting point, you'll see that there is only one difference: an extra <code>required_class</code>.</p><img src="https://dev-to-uploads.s3.amazonaws.com/i/j03a8ptbymo67f37whm2.png" alt="Alt Text"/><p>Now, this is üòé.</p><p>What would that form builder look like? Here's my take on this. It's the first form builder I write, so if you have more experienced and notice something weird please do tell.</p><pre><code><div class="highlight"><span></span><span class="c1"># app/form_builders/requiring_form_builder.rb</span>
<span class="k">class</span> <span class="nc">RequiringFormBuilder</span> <span class="o">&lt;</span> <span class="no">ActionView</span><span class="o">::</span><span class="no">Helpers</span><span class="o">::</span><span class="no">FormBuilder</span>
  <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="n">text_is_options</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span>
    <span class="n">required</span> <span class="o">=</span> <span class="n">text_is_options</span> <span class="p">?</span> <span class="n">text</span><span class="o">[</span><span class="ss">:required</span><span class="o">]</span> <span class="p">:</span> <span class="n">options</span><span class="o">[</span><span class="ss">:required</span><span class="o">]</span>
    <span class="k">if</span> <span class="n">required</span>
      <span class="n">required_class</span> <span class="o">=</span> <span class="n">text_is_options</span> <span class="p">?</span> <span class="n">text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:required_class</span><span class="p">)</span> <span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:required_class</span><span class="p">)</span>
      <span class="k">super</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">label_builder</span><span class="o">|</span>
        <span class="vi">@template</span><span class="o">.</span><span class="n">concat</span> <span class="n">label_builder</span><span class="o">.</span><span class="n">translation</span>
        <span class="vi">@template</span><span class="o">.</span><span class="n">concat</span> <span class="vi">@template</span><span class="o">.</span><span class="n">content_tag</span><span class="p">(</span><span class="ss">:span</span><span class="p">,</span> <span class="no">I18n</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="ss">scope</span><span class="p">:</span> <span class="ss">:helpers</span><span class="p">),</span> <span class="ss">class</span><span class="p">:</span> <span class="n">required_class</span><span class="p">)</span>
        <span class="vi">@template</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="vi">@template</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">label_builder</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">))</span> <span class="k">if</span> <span class="nb">block_given?</span>
      <span class="k">end</span>
    <span class="k">else</span>
      <span class="k">super</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</div></code></pre><p>There are two other things required for this to work.</p><p>First, the form_with declaration must declare the builder:</p><pre><code><div class="highlight"><span></span><span class="p">=</span> <span class="n">form_with</span> <span class="ss">model</span><span class="p">:</span> <span class="vi">@user</span><span class="p">,</span> <span class="ss">builder</span><span class="p">:</span> <span class="no">RequiringFormBuilder</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</div></code></pre><p>Second, you might have noticed that I use <code>I18n.t("required", scope: :helpers)</code> and not <code>I18n.t("required")</code> as we did before because it seems more appropriate to put that under the <code>helpers</code> namespace (in my case in a file called <code>config/locals/helpers/en.yml</code>). So you need to move that in the proper translation file, or at the minimum to change</p><pre><code><div class="highlight"><span></span><span class="nt">en</span><span class="p">:</span>
  <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">required</span>
</div></code></pre><p>into</p><pre><code><div class="highlight"><span></span><span class="nt">en</span><span class="p">:</span>
  <span class="nt">helpers</span><span class="p">:</span>
    <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">required</span>
</div></code></pre><p>I won't go into the details, but I'll point to two parts in the rails code that helped me write this code. <em> https://github.com/rails/rails/blob/a0e0f0263902896a7aacf703bcab35bee16bdaf8/actionview/lib/action</em>view/helpers/tags/label.rb#L30 because text can, in fact, be the options <em> https://github.com/rails/rails/blob/477fae3eb3d3b3bfdbe28586fecb8578c0be4721/actionview/lib/action</em>view/helpers/form_helper.rb#L1924 because we don't want to break block calling (<code>do |label_builder|</code>)</p><p>With this form builder, we can now simply add a <code>required_class</code> to any required label field.</p><p>If you enjoyed this article, you can follow me on Twitter <a href="https://twitter.com/sowenjub">@sowenjub</a>.</p>]]></content:encoded></item></channel></rss>